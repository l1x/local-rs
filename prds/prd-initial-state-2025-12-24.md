# PRD: Local-RS Initial State

## 1. Overview

Local-RS is a high-performance, lightweight reverse proxy server written in Rust. It is designed to serve static frontend assets while proxying API requests to a backend server. This tool simplifies local development and deployment of single-page applications (SPAs) or static sites that consume a separate backend API, providing detailed request tracing and logging.

## 2. Goals

1.  **Serve Static Content**: Efficiently serve static files (HTML, CSS, JS, images) from a specified directory.
2.  **Proxy API Requests**: Forward API requests to a backend server, handling path rewriting and header management.
3.  **Request Tracing**: Provide clear, color-coded logging with unique request IDs to trace requests through the system.
4.  **Developer Experience**: Offer a simple CLI interface for configuration and execution.

## 3. User Stories

- **As a frontend developer**, I want to serve my build artifacts (e.g., `dist/`) locally so that I can verify the production build.
- **As a full-stack developer**, I want to proxy API calls to my running backend service so that I don't have to deal with CORS issues during development.
- **As a developer**, I want to see colored logs with request IDs so that I can easily distinguish between concurrent requests and track their latency.
- **As a DevOps engineer**, I want to configure the server bind address and API target via command-line arguments so that I can easily deploy it in different environments.

## 4. Functional Requirements

### FR-1: Static File Serving

- **Acceptance**: The server must serve files from the directory specified by `--static-dir`.
- **Acceptance**: Requests to a directory path must automatically serve `index.html` if it exists.
- **Acceptance**: The server must return the correct `Content-Type` header based on the file extension.
- **Acceptance**: If a file is not found, the server must return a 404 status code (unless handled by a fallback, though currently explicit 404 logic exists).

### FR-2: API Proxying

- **Acceptance**: Requests matching the configured API path prefix (default `/pz`) must be forwarded to the backend API specified by `--api`.
- **Acceptance**: The proxy must preserve the HTTP method and request body.
- **Acceptance**: Query parameters must be preserved in the forwarded request.
- **Acceptance**: Hop-by-hop headers (e.g., `Host`, `Connection`) must be filtered out before forwarding.
- **Acceptance**: The response from the backend must be streamed back to the client.

### FR-3: Request Logging & Tracing

- **Acceptance**: Every request must be assigned a unique 5-character ID.
- **Acceptance**: Logs must display the request ID, HTTP method, path, and response status.
- **Acceptance**: Request IDs must be deterministically colored based on their value for visual distinction.
- **Acceptance**: Logs must include latency measurements for both the proxy round-trip and the total request time.

### FR-4: CLI Configuration

- **Acceptance**: The application must accept `--static-dir` (required) to specify the static file root.
- **Acceptance**: The application must accept `--api` (required) to specify the backend address.
- **Acceptance**: The application must accept `--api-path` (optional, default `/pz`) to configure the API route prefix.
- **Acceptance**: The application must accept `--bind` (optional, default `127.0.0.1:8000`) to configure the listening address.

## 5. Non-functional Requirements

### NFR-1: Performance

- **Acceptance**: The server should introduce minimal overhead (< 5ms) to proxied requests.
- **Acceptance**: Static file serving should use async I/O to handle concurrent requests efficiently.

### NFR-2: Usability

- **Acceptance**: The CLI must provide help text (`--help`) explaining all arguments.
- **Acceptance**: Error messages (e.g., invalid static dir) should be clear and informative.

### NFR-3: Reliability

- **Acceptance**: The server should not crash on backend connection failures; it should return a 502 Bad Gateway.

## 6. Non-Goals

- **SSL/TLS Termination**: The server is intended for local use or behind a load balancer; HTTPS is not natively supported.
- **Authentication/Authorization**: The proxy does not enforce security policies; it passes requests through.
- **Caching**: No internal caching mechanism for static files or API responses is implemented.
- **Hot Reloading**: The server does not watch for file changes; it serves what is on disk.

## 7. Success Metrics

- **Startup Success Rate**: Percentage of times the server starts successfully with valid arguments.
- **Request Latency**: Average time added to API requests.
- **Error Rate**: Frequency of 5xx errors generated by the proxy itself (excluding backend errors).
